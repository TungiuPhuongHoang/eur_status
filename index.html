<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Live Offers Poll (with Luxon adapter)</title>
    <!-- Chart.js core -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Luxon (for date handling) -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <!-- Chart.js adapter for Luxon -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
</head>
<body>
<h2>Offer Response Over Time</h2>
<p>Current Price: <span id="currentPrice">-</span></p>
<canvas id="liveChart" width="800" height="400"></canvas>

<script>
    const URL = "https://payment.flywire.com/payex/offers";
    const BODY = {
        amount: 1200000,
        country: "VN",
        recipient: "FKW",
        fingerprint: "rB/L4mgUx7JJIQARAxedAg==",
        locale: "en"
    };
    const HEADERS = {
        "Content-Type": "application/json",
        "Accept": "application/json"
    };

    const ctx = document.getElementById("liveChart").getContext("2d");
    const chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [],
            datasets: [{
                label: "Price Value",
                data: [],
                fill: false
            }]
        },
        options: {
            scales: {
                x: {
                    type: "time",           // ‚Üê needs the adapter!
                    time: {tooltipFormat: "HH:mm:ss"}
                }
            }
        }
    });

    async function fetchData() {
        try {
            const resp = await fetch(URL, {
                method: "POST",
                headers: HEADERS,
                body: JSON.stringify(BODY)
            });
            const json = await resp.json();
            const value = json.single[0].price.value/10;
            chart.data.labels.push(Date.now());
            chart.data.datasets[0].data.push(value);
            chart.update();
            document.getElementById("currentPrice").innerText = value;
        } catch (err) {
            console.error("Polling error:", err);
        }
    }

    fetchData();
    setInterval(fetchData, 60000);
</script>
</body>
</html>